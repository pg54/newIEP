<template>
    <div class="paperform-form">
        <div id="cpepTbWrap">
            <table id="cpepTb" class="tg">
                <tr>
                    <th class="tg-yw4l tranFourBorders" style="text-align: center;font-size: 18px;font-weight: bold" colspan="24">
                        C-PEP-3
                    </th>
                </tr>
                <tr>
                    <th class="tg-yw4l tranFourBorders " style="text-align: center;font-size: 18px;font-weight: bold" colspan="11">

                    </th>
                    <th class="tg-yw4l" style="text-align: center;font-size: 18px;font-weight: bold" colspan="13">
                    </th>
                </tr>
                <tr>
                    <th class="tg-yw4l tranFourBorders leftAlign" style="text-align: left" colspan="7">
                        姓名：

                    </th>
                    <th class="tg-nrw8 tranThreeBorders leftAlign" colspan="4">各项总和#</th>
                    <th class="tg-031e">6</th>
                    <th class="tg-031e">7</th>
                    <th class="tg-031e">6</th>
                    <th class="tg-031e">14</th>
                    <th class="tg-031e">11</th>
                    <th class="tg-031e tranThreeBorders">#</th>
                    <th class="tg-031e">10</th>
                    <th class="tg-031e">11</th>
                    <th class="tg-031e">10</th>
                    <th class="tg-031e">11</th>
                    <th class="tg-031e">14</th>
                    <th class="tg-031e">20</th>
                    <th class="tg-yw4l">19</th>
                </tr>
                <tr>
                    <td class="tg-yw4l tranFourBorders leftAlign" colspan="7">
                        性别：
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </td>
                    <td class="tg-yw4l tranThreeBorders leftAlign" colspan="4">合计数A</td>
                    <td class="tg-yw4l">{{ resultData[0].Result.A}}</td>
                    <td class="tg-yw4l">{{ resultData[1].Result.A}}</td>
                    <td class="tg-yw4l">{{ resultData[2].Result.A}}</td>
                    <td class="tg-yw4l">{{ resultData[3].Result.A}}</td>
                    <td class="tg-yw4l">{{ resultData[4].Result.A}}</td>
                    <td class="tg-yw4l tranThreeBorders">P</td>
                    <td class="tg-yw4l">{{ resultData[5].Result.P}}</td>
                    <td class="tg-yw4l">{{ resultData[6].Result.P}}</td>
                    <td class="tg-yw4l">{{ resultData[7].Result.P}}</td>
                    <td class="tg-yw4l">{{ resultData[8].Result.P}}</td>
                    <td class="tg-yw4l">{{ resultData[9].Result.P}}</td>
                    <td class="tg-yw4l">{{ resultData[10].Result.P}}</td>
                    <td class="tg-yw4l">{{ resultData[11].Result.P}}</td>
                </tr>
                <tr>
                    <td class="tg-yw4l tranFourBorders leftAlign" colspan="7">
                        年龄：
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </td>
                    <td class="tg-yw4l tranThreeBorders leftAlign" colspan="4">合计数M</td>
                    <td class="tg-yw4l">{{ resultData[0].Result.M}}</td>
                    <td class="tg-yw4l">{{ resultData[1].Result.M}}</td>
                    <td class="tg-yw4l">{{ resultData[2].Result.M}}</td>
                    <td class="tg-yw4l">{{ resultData[3].Result.M}}</td>
                    <td class="tg-yw4l">{{ resultData[4].Result.M}}</td>
                    <td class="tg-yw4l tranThreeBorders">E</td>
                    <td class="tg-yw4l">{{ resultData[5].Result.E}}</td>
                    <td class="tg-yw4l">{{ resultData[6].Result.E}}</td>
                    <td class="tg-yw4l">{{ resultData[7].Result.E}}</td>
                    <td class="tg-yw4l">{{ resultData[8].Result.E}}</td>
                    <td class="tg-yw4l">{{ resultData[9].Result.E}}</td>
                    <td class="tg-yw4l">{{ resultData[10].Result.E}}</td>
                    <td class="tg-yw4l">{{ resultData[11].Result.E}}</td>
                </tr>
                <tr>
                    <td class="tg-yw4l tranFourBorders leftAlign" colspan="7">
                        出生日期：
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </td>
                    <td class="tg-yw4l tranThreeBorders leftAlign" colspan="4">合计数S</td>
                    <td class="tg-yw4l">{{ resultData[0].Result.S}}</td>
                    <td class="tg-yw4l">{{ resultData[1].Result.S}}</td>
                    <td class="tg-yw4l">{{ resultData[2].Result.S}}</td>
                    <td class="tg-yw4l">{{ resultData[3].Result.S}}</td>
                    <td class="tg-yw4l">{{ resultData[4].Result.S}}</td>
                    <td class="tg-yw4l tranThreeBorders">E</td>
                    <td class="tg-yw4l">{{ resultData[5].Result.F}}</td>
                    <td class="tg-yw4l">{{ resultData[6].Result.F}}</td>
                    <td class="tg-yw4l">{{ resultData[7].Result.F}}</td>
                    <td class="tg-yw4l">{{ resultData[8].Result.F}}</td>
                    <td class="tg-yw4l">{{ resultData[9].Result.F}}</td>
                    <td class="tg-yw4l">{{ resultData[10].Result.F}}</td>
                    <td class="tg-yw4l">{{ resultData[11].Result.F}}</td>
                </tr>
                <tr>
                    <td class="tg-yw4l tranFourBorders leftAlign" colspan="7">
                        测试日期：
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </td>
                    <td class="tg-yw4l tranFourBorders" colspan="17"></td>
                </tr>
                <tr>
                    <td class="tg-yw4l tranFourBorders leftAlign" colspan="7">
                        测试者：
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </td>
                    <td class="tg-yw4l tranFourBorders" colspan="10"></td>
                    <td class="tg-baqh tranFourBorders" colspan="5">发展评分</td>
                    <td class="tg-baqh tranFourBorders" colspan="2">
                        <span class="fourBorder">{{ deveScore }}</span>
                    </td>
                </tr>
                <tr>
                    <td class="tg-yw4l tranFourBorders leftAlign" colspan="7">
                        住址：
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </td>
                    <td class="tg-yw4l tranFourBorders" colspan="17"></td>
                </tr>
                <tr>
                    <td class="tg-yw4l tranFourBorders leftAlign" colspan="7">
                        父母姓名：
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </td>
                    <td class="tg-yw4l tranFourBorders" colspan="17"></td>
                </tr>
                <tr>
                    <td class="tg-yw4l tranFourBorders leftAlign" colspan="7">
                        联系电话：
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </td>
                    <td class="tg-yw4l tranFourBorders" colspan="17"></td>
                </tr>

                <template v-for="unit in testResultData">
                    <tr>
                        <td class="tg-yw4l leftAlign tranFourBorders questionsTitle" colspan="11">
                            {{ unit.material}}
                        </td>
                        <td class="tg-yw4l" colspan="13" style="border-right: transparent;border-left: transparent"></td>
                    </tr>
                    <tr v-for="ele in unit.sameArr">
                        <td class="tg-yw4l leftAlign tranThreeBorders" colspan="11">
                            {{ele.Number}}&nbsp;&nbsp;{{ ele.Name}}
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </td>
                        <td class="tg-yw4l">{{ ele.Domain === '情感'? ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '人际关系'? ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '物品喜好'? ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '感觉模式'? ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '语言'? ele.Result: ' '}}</td>

                        <td class="tg-yw4l"></td>

                        <td class="tg-yw4l">{{ ele.Domain === '模仿'? ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '知觉'? ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '精细动作'? ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '粗大动作'? ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '手眼协调'? ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '认知表现'?ele.Result: ' '}}</td>
                        <td class="tg-yw4l">{{ ele.Domain === '口语认知'? ele.Result: ' '}}</td>
                    </tr>
                </template>

                <tfoot>
                <tr>
                    <th class="tg-yw4l tranThreeBorders" colspan="11" rowspan="4"></th>
                    <th class="tg-s6z2" rowspan="4">情<br>感</th>
                    <th class="tg-031e" rowspan="4">人<br>际<br>关<br>系</th>
                    <th class="tg-031e" rowspan="4">物<br>品<br>喜<br>好</th>
                    <th class="tg-031e" rowspan="4">感<br>觉<br>模<br>式</th>
                    <th class="tg-031e" rowspan="4">语<br>言</th>
                    <th class="tg-031e" rowspan="4">
                        &nbsp;&nbsp;&nbsp;
                    </th>
                    <th class="tg-031e" rowspan="4">模<br>仿</th>
                    <th class="tg-031e" rowspan="4">知<br>觉</th>
                    <th class="tg-031e" rowspan="4">精<br>细<br>动<br>作</th>
                    <th class="tg-031e" rowspan="4">粗<br>大<br>动<br>作</th>
                    <th class="tg-031e" rowspan="4">手<br>眼<br>协<br>调</th>
                    <th class="tg-031e" rowspan="4">认<br>知<br>表<br>现</th>
                    <th class="tg-031e" rowspan="4">口<br>语<br>认<br>知</th>
                </tr>
                <tr>
                </tr>
                <tr>
                </tr>
                <tr>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>

</template>

<script>
    import api from '../api/index.js';
    export default {
        name: 'printCECPScore',
        data() {
            return {
                frstMaterialType: '',
                difMaterialTypeEle: '',
                testResultData: '',
                resultData: [],
                deveScore: ''
            }
        },
        computed: {
            cpPacientID: function () {
                return this.$store.state.mystudent.currentPatientId.ID
            },
            cpTestID: function () {
                return this.$store.state.mystudent.cpepTestID
            }
        },
        methods: {
            getSourceData(urlArr) {
                let arr =  urlArr.TestResult.map(function (ele) {
                    return ele.MaterialType;
                }).filter(function(element,index,arr){
                    return arr.indexOf(element) === index;
                }).map(function (ele) {
                    let sameMaterial = []
                    let obj = {
                        material: ele,
                        sameArr: sameMaterial
                    }
                    return obj
                });
                urlArr.TestResult.forEach(function (ele) {
                    for (let i = 0; i< arr.length; i++) {
                        if (arr[i].material === ele.MaterialType) {
                            arr[i].sameArr.push(ele)
                        }
                    }
                })
                return arr
            },
            rquestData() {
                console.log('CPEP request');
                let params = {
                    testId: this.cpTestID,
                    PatientAgentID: this.cpPacientID,
                    PageIndex: 1,
                    PageSize: 10
                };
                api.getCPEPReport(params).then(res => {
                    var urlArr =  res.data.Data;
                    this.testResultData = this.getSourceData(urlArr)
                    this.resultData = urlArr.Result
                    this.deveScore = this.calcDevScore(urlArr.Result)

//                    let originData = urlArr.Result
//                    for (let i = 0;i < 5;i++) {
//                        this.roundData.push(originData[i])
//                    }
//                    this.drawRound(this.roundData);
//                    for (let j = 5;j < originData.length;j++) {
//                        this.lineData.push(originData[j])
//                    }
//                    this.drawDevelopChart(this.lineData);

                })
            },
            calcDevScore(arr) {
                let result = 0;
                for (let i = 5;i < arr.length; i++) {
                    result += arr[i].Result.P
                }
                return result
            },
            setNowMaterialType(param) {
                if (param.MaterialType === this.frstMaterialType) {
                    return true
                } else {
                    this.difMaterialTypeEle = param;
                    this.frstMaterialType = param.MaterialType;
                    return false;
                }
            }
        },
        created() {
            console.log('created')
            this.rquestData()
        },
        mounted() {
            console.log('mounted')
            this.rquestData()
        },
        updated() {
//            console.log('updated')
//            this.rquestData()
        }
    }
</script>
<style scoped>
    .tg  {border-collapse:collapse;border-spacing:0;}
    .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
    .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
    .tg .tg-baqh{text-align:center;vertical-align:top}
    .tg .tg-nrw8{font-size:14px}
    .tg .tg-yw4l{vertical-align:top}

    .tg  {border-collapse:collapse;border-spacing:0;}
    .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
    .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
    .tg .tg-s6z2{text-align:center}
    .tg .tg-yw4l{vertical-align:top}

    .leftAlign {
        text-align: left;
    }
    .rightAlign {
        text-align: right;
    }

    .tranFourBorders {
        border: transparent;
    }
    .tranThreeBorders {
        border-top: transparent;
        border-bottom: transparent;
        border-left: transparent;
    }
    .onlyBottom {
        border-top: transparent;
        border-right: transparent;
        border-left: transparent;
    }
    .onlySides {
        border-top: transparent;
        border-bottom: transparent;
    }

    .fourBorder {
        display: block;
        border: 1px solid #000000;
    }

    .questionsTitle {
        font-size: 16px;
        font-weight: bold;
    }


    .roundTitle {


    }
    .round_img {

    }

    .round_react_emotion {
        position: absolute;
        top: 110px;
        left: 280px;
        width: 100px;
        height: 40px;
        border: 1px solid #000000;
        text-align: center;
        line-height: 40px;
    }
    .round_react_lang {
        position: absolute;
        top: 180px;
        left: 20px;
        width: 100px;
        height: 40px;
        line-height: 40px;
        border: 1px solid #000000;
        text-align: center;
    }

    .round_react_relationship {
        position: absolute;
        top: 242px;
        left: 485px;
        width: 110px;
        height: 40px;
        border: 1px solid #000000;
        text-align: center;

    }
    .round_react_sense {
        position: absolute;
        top: 480px;
        left: 20px;
        width: 100px;
        height: 40px;
        line-height: 40px;
        border: 1px solid #000000;
        text-align: center;
    }
    .round_react_game {
        position: absolute;
        top: 520px;
        left: 440px;
        width: 100px;
        height: 40px;
        line-height: 40px;
        border: 1px solid #000000;
        text-align: center;
    }

    .chartText {
        width: 600px;
    }


</style>
